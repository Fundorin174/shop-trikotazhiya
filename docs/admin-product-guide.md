# Инструкция: создание товара в админке Medusa

Админка доступна по адресу: **http://localhost:9000/app**  
Логин: `admin@trikotazhiya.ru` / Пароль: `__ADMIN_PASSWORD__`

---

## Оглавление

1. [Создание товара](#1-создание-товара)
2. [Заполнение metadata (характеристики ткани)](#2-заполнение-metadata)
3. [Настройка варианта и цены](#3-настройка-варианта-и-цены)
4. [Загрузка изображений](#4-загрузка-изображений)
5. [Настройка инвентаря (наличие и количество)](#5-настройка-инвентаря)
6. [Привязка к каналу продаж](#6-привязка-к-каналу-продаж)
7. [Публикация товара](#7-публикация-товара)
8. [Справочник полей metadata](#8-справочник-полей-metadata)

---

## 1. Создание товара

1. Перейдите в **Products** в левом меню
2. Нажмите кнопку **Create Product** (правый верхний угол)
3. Заполните основные поля:

| Поле | Описание | Пример |
|------|----------|--------|
| **Title** | Название товара | `Футер 3-нитка с начёсом` |
| **Subtitle** | Краткое описание (состав, плотность) | `80% хлопок, 20% полиэстер, 320 г/м²` |
| **Handle** | URL-слаг (латиница, через дефис) | `futer-3-nitka-s-nachyosom` |
| **Description** | Полное описание товара | Текст для карточки товара |
| **Discountable** | Можно ли применять скидки | ✅ Да |

4. Нажмите **Save** — товар будет создан в статусе **Draft**

---

## 2. Заполнение metadata

Metadata — это JSON-поля, в которых хранятся все характеристики ткани. Без них товар не будет корректно отображаться на сайте.

### Как открыть редактор metadata

1. Откройте созданный товар
2. Прокрутите вниз до секции **Metadata**
3. Нажмите **Edit Metadata**
4. Добавляйте поля по одному: нажмите **Add row**, введите **Key** и **Value**

### Обязательные поля metadata

Добавьте каждое поле как отдельную строку:

| Key | Value (пример) | Описание |
|-----|----------------|----------|
| `sku` | `TK-FTR-002` | Артикул товара (уникальный) |
| `fabric_type` | `footer` | Тип ткани (см. [справочник](#допустимые-значения-fabric_type)) |
| `composition` | `80% хлопок, 20% полиэстер, 320 г/м²` | Состав и плотность |
| `quality` | `Пенье` | Качество ткани |
| `width_cm` | `185` | Ширина полотна в см (число) |
| `measurement_unit` | `running_meter` | Единица измерения (см. [справочник](#допустимые-значения-measurement_unit)) |
| `min_order` | `0.5` | Минимальный заказ (число) |
| `order_step` | `0.1` | Шаг заказа (число) |
| `country` | `Турция` | Страна производства |
| `collection_name` | `Футер коллекция` | Название коллекции |
| `color` | `Серый меланж` | Название цвета |
| `color_hex` | `#B0B0B0` | Цвет в формате HEX |

### Необязательные поля metadata

| Key | Value (пример) | Описание |
|-----|----------------|----------|
| `short_description` | `Плотный тёплый футер` | Краткое описание для превью |
| `discount_percent` | `15` | Размер скидки в % (число) |
| `video_url` | `https://youtube.com/...` | Ссылка на видео |

5. После заполнения всех полей нажмите **Save**

> ⚠️ **Важно**: значения `width_cm`, `min_order`, `order_step`, `discount_percent` вводите как числа, без кавычек.

---

## 3. Настройка варианта и цены

Каждый товар должен иметь хотя бы один вариант с ценой.

### Создание варианта

1. В карточке товара перейдите в секцию **Variants**
2. Нажмите **Add Variant**
3. Заполните:

| Поле | Значение | Пример |
|------|----------|--------|
| **Title** | Название варианта | `По метражу` |
| **SKU** | Артикул (тот же, что в metadata) | `TK-FTR-002` |
| **Manage Inventory** | ✅ Включить | Обязательно для учёта остатков |

4. Нажмите **Save**

### Настройка опции (единицы продажи)

При создании варианта Medusa попросит указать **Option**:

- **Option Title**: `Единица`
- **Option Value**: `1 метр`

### Установка цены

1. В секции **Variants** нажмите на созданный вариант
2. Перейдите в **Prices**
3. Нажмите **Add Price** или **Edit Prices**
4. Выберите валюту **RUB**
5. Введите цену **в копейках**:

| Цена на сайте | Значение в поле Amount |
|---------------|----------------------|
| 450 ₽ | `45000` |
| 699 ₽ | `69900` |
| 1 250 ₽ | `125000` |
| 99,50 ₽ | `9950` |

> ⚠️ **Важно**: Medusa хранит цены в минорных единицах (копейках). Цена `699` в поле Amount = **6,99 ₽**, а не 699 ₽! Для 699 ₽ нужно ввести `69900`.

6. Нажмите **Save**

---

## 4. Загрузка изображений

1. В карточке товара перейдите в секцию **Media**
2. Нажмите **Upload Media** или перетащите файлы
3. Загрузите фотографии товара (рекомендуется 2–4 фото)
4. **Thumbnail**: можно выбрать одно из загруженных фото как миниатюру (нажмите на фото и выберите **Set as thumbnail**). Если thumbnail не задан, на сайте будет показано первое изображение из галереи.

### Рекомендации по фото

- Формат: JPG, PNG или WebP
- Размер: не менее 800×1000 px
- Фон: белый или нейтральный
- Покажите текстуру ткани крупным планом

---

## 5. Настройка инвентаря

Это самый важный шаг — без него товар будет отображаться как **«Нет в наличии»**.

### Структура инвентаря в Medusa

```
Товар (Product)
  └── Вариант (Variant)
        └── Inventory Item (Единица складского учёта)
              └── Inventory Level (Уровень запаса на складе)
                    ├── stocked_quantity — сколько есть
                    ├── reserved_quantity — сколько зарезервировано
                    └── available_quantity — сколько доступно
```

### Шаг 5.1: Проверить склад

Склад «Основной склад» (`sloc_01KJ0C2S3ETR2JNVB7HFD3D2ZN`) уже создан и привязан к каналу продаж. Проверить:

1. Перейдите в **Settings** → **Locations & Shipping**
2. Убедитесь, что есть склад «Основной склад»
3. Убедитесь, что он привязан к Sales Channel «Trikotazhiya Storefront»

### Шаг 5.2: Привязать Inventory Item к варианту

При создании варианта с включённым **Manage Inventory**, Medusa автоматически создаёт Inventory Item. Проверить:

1. Перейдите в **Inventory** в левом меню
2. Найдите Inventory Item по SKU вашего товара
3. Если его нет — создайте вручную (кнопка **Create Inventory Item**)

### Шаг 5.3: Установить количество на складе

1. В разделе **Inventory** найдите нужный Inventory Item
2. Нажмите на него
3. В секции **Location Levels** нажмите **Manage Locations** или **Adjust**
4. Выберите склад «Основной склад»
5. Укажите **Stocked Quantity** — количество в наличии

| Ткань | Единица | Пример |
|-------|---------|--------|
| Футер 3-нитка | пог. м | `20` (= 20 погонных метров) |
| Кулирка | пог. м | `50` (= 50 погонных метров) |
| Купон с принтом | шт. | `10` (= 10 штук) |
| Фурнитура | шт. | `100` (= 100 штук) |

6. Нажмите **Save**

> ⚠️ **Важно**: поле `required_quantity` в привязке Inventory Item → Variant должно быть равно **1**. Если оно больше 1, Medusa будет считать, что на один заказ нужно столько единиц инвентаря, и покажет меньшее количество доступных единиц.

### Проверка через API

Проверить, что инвентарь настроен правильно, можно запросом:

```powershell
$h = @{ "x-publishable-api-key" = "pk_d9fa454634dc0b1e136c236d7c34e27db19942c2494a8143d762973ed7b57d8e" }
$p = (Invoke-RestMethod -Uri "http://localhost:9000/store/products?handle=HANDLE_ТОВАРА&fields=*variants,*variants.inventory_quantity" -Headers $h).products[0]
Write-Output "Quantity: $($p.variants[0].inventory_quantity)"
```

---

## 6. Привязка к каналу продаж

Чтобы товар был виден на сайте, он должен быть привязан к каналу продаж.

1. В карточке товара найдите секцию **Sales Channels**
2. Нажмите **Edit Sales Channels**
3. Отметьте ✅ **Trikotazhiya Storefront**
4. Нажмите **Save**

> Без привязки к каналу продаж товар не будет возвращаться Store API и не появится на сайте.

---

## 7. Публикация товара

1. В карточке товара найдите поле **Status** (обычно вверху страницы)
2. Измените статус с **Draft** на **Published**
3. Нажмите **Save**

Товар появится на сайте в течение нескольких секунд.

---

## 8. Справочник полей metadata

### Допустимые значения `fabric_type`

| Значение | Название на сайте |
|----------|-------------------|
| `kulirka` | Кулирка |
| `footer` | Футер |
| `kapitoniy` | Капитоний |
| `kashkorse` | Кашкорсе |
| `pike` | Пике |
| `ribana` | Рибана |
| `interlok` | Интерлок |
| `kupony` | Купоны с принтом |
| `trikotazh_vyazka` | Трикотажная вязка |
| `termopolotno` | Термополотно |
| `dzhersi` | Джерси |
| `furnitura` | Фурнитура |

### Допустимые значения `measurement_unit`

| Значение | На сайте | Когда использовать |
|----------|----------|--------------------|
| `running_meter` | пог. м | Ткани (продажа по метражу) |
| `piece` | шт. | Купоны с принтом, фурнитура |

### Параметры заказа по типу товара

| Тип товара | `measurement_unit` | `min_order` | `order_step` |
|------------|-------------------|-------------|-------------|
| Ткани (кулирка, футер, и т.д.) | `running_meter` | `0.5` | `0.1` |
| Купоны с принтом | `piece` | `1` | `1` |
| Фурнитура | `piece` | `1` | `1` |

---

## Чек-лист: создание нового товара

- [ ] Создать товар (Title, Handle, Description)
- [ ] Заполнить metadata (sku, fabric_type, composition, measurement_unit, min_order, order_step, и т.д.)
- [ ] Создать вариант (Title, SKU, Manage Inventory ✅)
- [ ] Установить цену в RUB (в копейках!)
- [ ] Загрузить фотографии (2–4 шт.)
- [ ] Настроить инвентарь (Inventory Item → Location Level → Stocked Quantity)
- [ ] Привязать к каналу продаж «Trikotazhiya Storefront»
- [ ] Изменить статус на **Published**
- [ ] Проверить на сайте: http://localhost:3001/products/HANDLE

---

## Частые ошибки

| Проблема | Причина | Решение |
|----------|---------|---------|
| Цена 6,99 ₽ вместо 699 ₽ | Цена задана как `699` вместо `69900` | Цена в копейках: умножайте на 100 |
| «Нет в наличии» | Нет Inventory Level для склада | Создайте Location Level со Stocked Quantity |
| Показывает 1 шт. при 20 на складе | `required_quantity` > 1 | Установите `required_quantity = 1` |
| Нет фото в каталоге | Не задан thumbnail | Задайте thumbnail или загрузите images |
| Товар не виден на сайте | Не привязан к Sales Channel | Добавьте «Trikotazhiya Storefront» |
| Товар не виден на сайте | Статус = Draft | Измените на Published |
| Неверный тип в каталоге | Неправильный `fabric_type` в metadata | Используйте значения из справочника |
